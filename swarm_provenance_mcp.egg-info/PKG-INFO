Metadata-Version: 2.4
Name: swarm-provenance-mcp
Version: 0.1.0
Summary: MCP server for Swarm postage stamp management
Author: Swarm Provenance Team
License: MIT
Keywords: mcp,swarm,postage,stamps,decentralized
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: mcp>=1.0.0
Requires-Dist: requests>=2.31.0
Requires-Dist: pydantic>=2.0.0
Requires-Dist: python-dotenv>=1.0.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"
Requires-Dist: pytest-mock>=3.10.0; extra == "dev"
Requires-Dist: requests-mock>=1.10.0; extra == "dev"
Requires-Dist: psutil>=5.9.0; extra == "dev"
Requires-Dist: jsonschema>=4.0.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"
Requires-Dist: ruff>=0.1.0; extra == "dev"
Provides-Extra: test
Requires-Dist: pytest>=7.0.0; extra == "test"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "test"
Requires-Dist: pytest-mock>=3.10.0; extra == "test"
Requires-Dist: requests-mock>=1.10.0; extra == "test"
Requires-Dist: psutil>=5.9.0; extra == "test"
Requires-Dist: jsonschema>=4.0.0; extra == "test"
Provides-Extra: security
Requires-Dist: safety>=2.0.0; extra == "security"
Requires-Dist: bandit>=1.7.0; extra == "security"

# Swarm Provenance MCP

A Model Context Protocol (MCP) server for managing Swarm postage stamps through a centralized FastAPI gateway.

## Overview

This MCP server provides tools for AI agents to interact with Swarm postage stamps, including purchasing, extending, and monitoring stamps. It acts as a bridge between AI agents and the `swarm_connect` FastAPI gateway.

## Features

- **Purchase Stamps**: Create new postage stamps with configurable amount and depth
- **Stamp Status**: Get detailed information about specific stamps
- **List Stamps**: View all available postage stamps
- **Extend Stamps**: Add additional funds to existing stamps
- **Data Upload**: Upload data to Swarm network with stamp validation
- **Data Download**: Download data from Swarm network by reference
- **Health Monitoring**: Check gateway and Swarm network connectivity

## Installation

### Prerequisites

- Python 3.8 or higher
- Internet connection (uses public gateway by default)
- Optional: Self-hosted `swarm_connect` gateway service (see Gateway Options below)

### Setup

1. Clone the repository:
```bash
cd /path/to/Provenance_Projects/swarm_provenance_mcp
```

2. Create and activate a virtual environment:
```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

3. Install the package:
```bash
pip install -e .
```

4. Configure environment variables:
```bash
cp .env.example .env
# Edit .env to configure your gateway URL and defaults
```

## Configuration

Environment variables (set in `.env` file):

- `SWARM_GATEWAY_URL`: URL of the swarm_connect FastAPI gateway (default: `https://provenance-gateway.datafund.io`)
- `DEFAULT_STAMP_AMOUNT`: Default amount for new stamps in wei (default: `2000000000`)
- `DEFAULT_STAMP_DEPTH`: Default depth for new stamps (default: `17`)

### Gateway Options

#### Public Gateway (Recommended)
The MCP server uses the public gateway hosted by DataFund by default at `https://provenance-gateway.datafund.io`. This gateway provides:
- High availability and reliability
- No setup or maintenance required
- Direct access to the Swarm network
- Free to use for development and testing

#### Self-Hosted Gateway
You can also run your own gateway instance for:
- Custom configurations
- Private or isolated environments
- Local development

To use a self-hosted gateway:
1. Clone the gateway repository: `git clone https://github.com/datafund/swarm_connect`
2. Follow the setup instructions in that repository
3. Update your `.env` file: `SWARM_GATEWAY_URL=http://localhost:8000`

## Usage

### Running the MCP Server

```bash
swarm-provenance-mcp
```

### Available Tools

#### `purchase_stamp`
Purchase a new postage stamp.

**Parameters:**
- `amount` (int): Amount in wei (optional, uses default if not provided)
- `depth` (int): Stamp depth (optional, uses default if not provided)
- `label` (string): Optional label for the stamp

**Example:**
```json
{
  "name": "purchase_stamp",
  "arguments": {
    "amount": 1000000000,
    "depth": 17,
    "label": "my-test-stamp"
  }
}
```

#### `get_stamp_status`
Get detailed information about a specific stamp.

**Parameters:**
- `stamp_id` (string): The batch ID of the stamp

**Example:**
```json
{
  "name": "get_stamp_status",
  "arguments": {
    "stamp_id": "000de42079daebd58347bb38ce05bdc477701d93651d3bba318a9aee3fbd786a"
  }
}
```

#### `list_stamps`
List all available postage stamps.

**Parameters:** None

**Example:**
```json
{
  "name": "list_stamps",
  "arguments": {}
}
```

#### `extend_stamp`
Extend an existing stamp with additional funds.

**Parameters:**
- `stamp_id` (string): The batch ID of the stamp to extend
- `amount` (int): Additional amount to add in wei

**Example:**
```json
{
  "name": "extend_stamp",
  "arguments": {
    "stamp_id": "000de42079daebd58347bb38ce05bdc477701d93651d3bba318a9aee3fbd786a",
    "amount": 500000000
  }
}
```

#### `upload_data`
Upload data to the Swarm network with stamp validation.

**Parameters:**
- `data` (string): Data content to upload (max 4096 bytes)
- `stamp_id` (string): Postage stamp ID to use for upload
- `content_type` (string): MIME type of the content (optional, default: "application/json")

**Example:**
```json
{
  "name": "upload_data",
  "arguments": {
    "data": "{\"message\": \"Hello Swarm!\"}",
    "stamp_id": "000de42079daebd58347bb38ce05bdc477701d93651d3bba318a9aee3fbd786a",
    "content_type": "application/json"
  }
}
```

#### `download_data`
Download data from the Swarm network using a reference hash.

**Parameters:**
- `reference` (string): Swarm reference hash of the data to download

**Example:**
```json
{
  "name": "download_data",
  "arguments": {
    "reference": "a1b2c3d4e5f6789abcdef0123456789abcdef0123456789abcdef0123456789a"
  }
}
```

#### `health_check`
Check gateway and Swarm network connectivity status.

**Parameters:** None

**Example:**
```json
{
  "name": "health_check",
  "arguments": {}
}
```

## Architecture

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   AI Agents     │◄──►│  MCP Server     │◄──►│ swarm_connect   │
│                 │    │                 │    │   Gateway       │
│ • Claude        │    │ • Tool handlers │    │                 │
│ • Other LLMs    │    │ • Gateway client│    │ • Purchase API  │
│ • Custom agents │    │ • Error handling│    │ • Status API    │
└─────────────────┘    └─────────────────┘    │ • Extension API │
                                              └─────────┬───────┘
                                                        │
                                              ┌─────────▼───────┐
                                              │  Swarm Network  │
                                              │   (Bee Node)    │
                                              └─────────────────┘
```

### Components

- **MCP Server**: Exposes tools via the Model Context Protocol
- **Gateway Client**: HTTP client for communicating with swarm_connect
- **Configuration**: Environment-based settings management
- **Error Handling**: Comprehensive error handling and logging

## Claude Desktop Integration

### Setup Instructions

1. **Install Claude Desktop**: Download from [claude.ai](https://claude.ai/download)

2. **Clone this repository and set up environment**:
```bash
git clone https://github.com/datafund/swarm_provenance_mcp.git
cd swarm_provenance_mcp

# Create and activate virtual environment
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install -e .
```

3. **Configure MCP Server**: Add to Claude Desktop's configuration file:

**macOS/Linux** (`~/Library/Application Support/Claude/claude_desktop_config.json`):
```json
{
  "mcpServers": {
    "swarm-provenance": {
      "command": "/path/to/swarm_provenance_mcp/venv/bin/python",
      "args": ["-m", "swarm_provenance_mcp.server"],
      "cwd": "/path/to/swarm_provenance_mcp"
    }
  }
}
```

**Windows** (`%APPDATA%\Claude\claude_desktop_config.json`):
```json
{
  "mcpServers": {
    "swarm-provenance": {
      "command": "C:\\path\\to\\swarm_provenance_mcp\\venv\\Scripts\\python.exe",
      "args": ["-m", "swarm_provenance_mcp.server"],
      "cwd": "C:\\path\\to\\swarm_provenance_mcp"
    }
  }
}
```

*Note: Replace `/path/to/swarm_provenance_mcp` with the actual path where you cloned the repository.*

**Alternative (if package is installed)**: You can use `"command": "swarm-provenance-mcp"` instead after running `pip install -e .`

4. **Restart Claude Desktop** and test with: "List all available Swarm stamps"

## Development

### Testing

```bash
# Install development dependencies
pip install -e .[dev]

# Run tests
pytest

# Run with coverage
pytest --cov=swarm_provenance_mcp
```

### Code Quality

```bash
# Format code
black swarm_provenance_mcp/

# Lint code
ruff check swarm_provenance_mcp/
```

## Dependencies

- **Core Dependencies**:
  - `mcp>=1.0.0`: Model Context Protocol framework
  - `requests>=2.31.0`: HTTP client for gateway communication
  - `pydantic>=2.0.0`: Data validation and settings
  - `python-dotenv>=1.0.0`: Environment configuration

- **Development Dependencies**:
  - `pytest`: Testing framework
  - `pytest-asyncio`: Async testing support
  - `pytest-mock`: Mocking utilities
  - `black`: Code formatting
  - `ruff`: Linting

## Integration with AI Agents

This MCP server is designed to work with AI agents that support the Model Context Protocol. Agents can use the provided tools to:

1. **Manage stamp inventory**: Purchase and extend stamps as needed
2. **Monitor usage**: Check stamp status and utilization
3. **Optimize costs**: List stamps to find the most suitable ones for tasks
4. **Automate workflows**: Integrate stamp management into larger AI workflows

## Troubleshooting

### Common Issues

1. **Connection errors**: Ensure the swarm_connect gateway is running and accessible
2. **Authentication errors**: Check that the gateway doesn't require authentication
3. **Invalid stamp IDs**: Verify stamp IDs are valid batch IDs from the Swarm network
4. **Timeout errors**: Increase timeout values if operations are taking too long

### Logging

The server logs important events and errors. To increase logging verbosity:

```python
import logging
logging.getLogger("swarm_provenance_mcp").setLevel(logging.DEBUG)
```

## License

MIT License - see LICENSE file for details.
